diff -wpruN '--exclude=*.orig' a~/encoding.c a/encoding.c
--- a~/encoding.c	1970-01-01 00:00:00
+++ a/encoding.c	1970-01-01 00:00:00
@@ -1408,7 +1408,7 @@ struct mchar *mc;
 	}
       /* FIXME: delete old char from all buffers */
     }
-  else if (!combchars[i])
+  else if (i < sizeof combchars / sizeof *combchars && !combchars[i])
     {
       combchars[i] = (struct combchar *)malloc(sizeof(struct combchar));
       if (!combchars[i])
