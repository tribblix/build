Backport of:

From 804edf772d254620f5a9f0b87135cfda15a59ee8 Mon Sep 17 00:00:00 2001
From: Hugo Landau <hlandau@openssl.org>
Date: Tue, 17 Jan 2023 17:45:42 +0000
Subject: [PATCH] CVE-2023-0286: Fix GENERAL_NAME_cmp for x400Address (1.1.1)

diff -wpruN --no-dereference '--exclude=*.orig' a~/crypto/x509v3/v3_genn.c a/crypto/x509v3/v3_genn.c
--- a~/crypto/x509v3/v3_genn.c	1970-01-01 00:00:00
+++ a/crypto/x509v3/v3_genn.c	1970-01-01 00:00:00
@@ -147,7 +147,7 @@ int GENERAL_NAME_cmp(GENERAL_NAME *a, GE
         return -1;
     switch (a->type) {
     case GEN_X400:
-        result = ASN1_TYPE_cmp(a->d.x400Address, b->d.x400Address);
+        result = ASN1_STRING_cmp(a->d.x400Address, b->d.x400Address);
         break;
 
     case GEN_EDIPARTY:
diff -wpruN --no-dereference '--exclude=*.orig' a~/crypto/x509v3/x509v3.h a/crypto/x509v3/x509v3.h
--- a~/crypto/x509v3/x509v3.h	1970-01-01 00:00:00
+++ a/crypto/x509v3/x509v3.h	1970-01-01 00:00:00
@@ -190,7 +190,7 @@ typedef struct GENERAL_NAME_st {
         OTHERNAME *otherName;   /* otherName */
         ASN1_IA5STRING *rfc822Name;
         ASN1_IA5STRING *dNSName;
-        ASN1_TYPE *x400Address;
+        ASN1_STRING *x400Address;
         X509_NAME *directoryName;
         EDIPARTYNAME *ediPartyName;
         ASN1_IA5STRING *uniformResourceIdentifier;
